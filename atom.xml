<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-09-06T08:27:01.768Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>mszj</title>
    <link href="http://yoursite.com/2019/08/26/mszj/"/>
    <id>http://yoursite.com/2019/08/26/mszj/</id>
    <published>2019-08-26T08:32:52.000Z</published>
    <updated>2019-09-06T08:27:01.768Z</updated>
    
    <content type="html"><![CDATA[<!--[TOC]--><h2 id="简单的一些linux面试题"><a href="#简单的一些linux面试题" class="headerlink" title="简单的一些linux面试题"></a>简单的一些linux面试题</h2><blockquote><p>你越不在乎别人的看法，生活就会变的越简单。</p></blockquote><a id="more"></a><h4 id="1-MySQL主从同步原理说明，查询主从同步的命令"><a href="#1-MySQL主从同步原理说明，查询主从同步的命令" class="headerlink" title="1. MySQL主从同步原理说明，查询主从同步的命令"></a>1. MySQL主从同步原理说明，查询主从同步的命令</h4><ul><li><p>开启binlog后，主库会生成一个 log dump 线程，用来给从库I/O线程传binlog;</p></li><li><p>开启slave后，从库生成两个线程，一个I/O线程，一个SQL线程;</p></li><li><p>I/O线程会去请求主库的binlog，并将得到的binlog日志写到relay log（中继日志） 文件中;</p></li><li><p>SQL线程会去读取relay log文件中的日志，并解析成具体操作，来实现主从的操作一致，而最终数据一致;</p></li><li><p><strong><em>查询主从同步的命令是: show slave status\G;</em></strong></p></li></ul><h4 id="2-主从同步的方式有哪些"><a href="#2-主从同步的方式有哪些" class="headerlink" title="2. 主从同步的方式有哪些"></a>2. 主从同步的方式有哪些</h4><h4 id="3-查看8080端口是否打开的是哪个服务"><a href="#3-查看8080端口是否打开的是哪个服务" class="headerlink" title="3. 查看8080端口是否打开的是哪个服务"></a>3. 查看8080端口是否打开的是哪个服务</h4><ul><li><strong><em>ss -luntp|grep  8080</em></strong></li></ul><h4 id="4-开发要查看tomcat的日志，但是太大了，不能用vim的方式，你怎么办"><a href="#4-开发要查看tomcat的日志，但是太大了，不能用vim的方式，你怎么办" class="headerlink" title="4. 开发要查看tomcat的日志，但是太大了，不能用vim的方式，你怎么办"></a>4. 开发要查看tomcat的日志，但是太大了，不能用vim的方式，你怎么办</h4><ul><li><p>问开发所需要日志的具体时间范围</p></li><li><p>通过sed取出日志并追加进新的文件，这样就能看到具体某时间段的日志sed -n ‘/2019-08-26 13:35:/,/2019-08-26 14:10:/p’ catalina.out &gt; 01.txt</p></li><li><p>还有第二种方法，一般这种情况可能是存在bug页面报错等情况，这时执行 tailf catalina.out &gt; 02.txt 让测试或开发还原报错过程，这样生成的日志更简短。</p></li></ul><h4 id="5-用户不能访问你的网站，但是你测试发现是可以的，然后你怎么排查"><a href="#5-用户不能访问你的网站，但是你测试发现是可以的，然后你怎么排查" class="headerlink" title="5. 用户不能访问你的网站，但是你测试发现是可以的，然后你怎么排查"></a>5. 用户不能访问你的网站，但是你测试发现是可以的，然后你怎么排查</h4><p>这里回答的可能不是很好哦。</p><ul><li>1.检查服务日志看是否有报错</li><li>2.联系用户看是否可以正常访问百度等网站</li><li>3.查看用户的DNS、网关和hosts文件是否有更改</li><li>4.查看服务器端的防火墙是否设置IP段不能访问</li><li>5.暂时打开服务器ping的功能，看用户端是否能够ping的通服务器。</li></ul><h4 id="6-定时任务-11月的每天早上6点至12点执行一个脚本"><a href="#6-定时任务-11月的每天早上6点至12点执行一个脚本" class="headerlink" title="6. 定时任务 11月的每天早上6点至12点执行一个脚本"></a>6. 定时任务 11月的每天早上6点至12点执行一个脚本</h4><ul><li><strong>00 6,8,10,12 * 11 * /bin/bash /home/root/test.sh &gt;/home/root/test.log &gt; 2&gt;&amp;1</strong></li><li><strong>00 6-12/2 * 11 * /bin/bash /home/root/test.sh &gt;/home/root/test.log &gt; 2&gt;&amp;</strong></li></ul><h4 id="7-binlog日志有那两种方式"><a href="#7-binlog日志有那两种方式" class="headerlink" title="7. binlog日志有那两种方式"></a>7. binlog日志有那两种方式</h4><h4 id="8-查看服务器硬件使用信息的命令"><a href="#8-查看服务器硬件使用信息的命令" class="headerlink" title="8. 查看服务器硬件使用信息的命令"></a>8. 查看服务器硬件使用信息的命令</h4><ul><li><strong>top</strong></li><li><strong>uptime</strong></li><li><strong>free -m</strong></li><li><strong>df -h</strong></li></ul><h4 id="9-keeplaviled的原理，用的什么协议"><a href="#9-keeplaviled的原理，用的什么协议" class="headerlink" title="9.  keeplaviled的原理，用的什么协议"></a>9.  keeplaviled的原理，用的什么协议</h4><blockquote><p>keepalived是以VRRP协议为实现基础的，VRRP全称Virtual Router Redundancy Protocol，即虚拟路由冗余协议。<br>虚拟路由冗余协议，可以认为是实现路由器高可用的协议，即将N台提供相同功能的路由器组成一个路由器组，这个组里面有一个master和多个backup，master上面有一个对外提供服务的vip（该路由器所在局域网内其他机器的默认路由为该vip），master会发组播，当backup收不到vrrp包时就认为master宕掉了，这时就需要根据VRRP的优先级来选举一个backup当master。这样的话就可以保证路由器的高可用了。<br>keepalived主要有三个模块，分别是core、check和vrrp。core模块为keepalived的核心，负责主进程的启动、维护以及全局配置文件的加载和解析。check负责健康检查，包括常见的各种检查方式。vrrp模块是来实现VRRP协议的。</p></blockquote><h4 id="10-mysql备份test库-并还原test库-命令"><a href="#10-mysql备份test库-并还原test库-命令" class="headerlink" title="10. mysql备份test库 并还原test库 命令"></a>10. mysql备份test库 并还原test库 命令</h4><ul><li><strong>mysqldump -u用户名 -p密码 test &gt; /home/root/test.sql</strong></li><li><strong>mysql -u用户名 -p密码 &lt; /home/root/test.sql</strong></li></ul><h4 id="11-mysql备份的时候-你用到了什么参数（除了-u-p-h）"><a href="#11-mysql备份的时候-你用到了什么参数（除了-u-p-h）" class="headerlink" title="11.mysql备份的时候 你用到了什么参数（除了-u -p -h）"></a>11.mysql备份的时候 你用到了什么参数（除了-u -p -h）</h4><ul><li>–add-drop-table：在每个创建数据库表语句前添加删除数据库表的语句；</li><li>–add-locks：备份数据库表时锁定数据库表；</li><li>–all-databases：备份MySQL服务器上的所有数据库；</li><li>–comments：添加注释信息；</li><li>–compact：压缩模式，产生更少的输出；</li><li>–complete-insert：输出完成的插入语句；</li><li>–databases：指定要备份的数据库；</li><li>–default-character-set：指定默认字符集；</li><li>–force：当出现错误时仍然继续备份操作；</li><li>–host：指定要备份数据库的服务器；</li><li>–lock-tables：备份前，锁定所有数据库表；</li><li>–no-create-db：禁止生成创建数据库语句；</li><li>–no-create-info：禁止生成创建数据库库表语句；</li></ul><h4 id="12-sed删除单数行"><a href="#12-sed删除单数行" class="headerlink" title="12.sed删除单数行"></a>12.sed删除单数行</h4><ul><li><strong>sed -i ‘1~2d’ filename</strong></li><li><strong>附送一个 awk的解决方法 awk ‘NR%2==0’ sed.txt</strong></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;!--[TOC]--&gt;
&lt;h2 id=&quot;简单的一些linux面试题&quot;&gt;&lt;a href=&quot;#简单的一些linux面试题&quot; class=&quot;headerlink&quot; title=&quot;简单的一些linux面试题&quot;&gt;&lt;/a&gt;简单的一些linux面试题&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;你越不在乎别人的看法，生活就会变的越简单。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Lftp+Sftp传输大文件</title>
    <link href="http://yoursite.com/2019/08/23/lftp+sftp/"/>
    <id>http://yoursite.com/2019/08/23/lftp+sftp/</id>
    <published>2019-08-23T08:58:34.000Z</published>
    <updated>2019-09-06T07:35:05.424Z</updated>
    
    <content type="html"><![CDATA[<!--[TOC]--><h2 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h2><p>因为备份数据的不断扩大，需要把现网备份的数据（2T左右）传回到本地进行异地保存。但是2T太大了，需要进行压缩，这里采用了3G一个压缩包的方式。以下是压缩脚本</p><blockquote><p>生活需要冲，更需要缓存。</p></blockquote><a id="more"></a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/bash</span><br><span class="line"><span class="meta">#</span> 此脚本是全量压缩mongodb备份的文件</span><br><span class="line">printf "开始mongodb备份压缩    $(date  +%Y%m%d_%A_%Z%T)\n"</span><br><span class="line">cd /data_master/backup/</span><br><span class="line">tar czf - picdb | split -b 3072m - picdb.tar.gz</span><br><span class="line">if [ $? != 0 ]</span><br><span class="line">    then</span><br><span class="line">printf "mongodb备份压缩失败    $(date  +%Y%m%d_%A_%Z%T)\n"</span><br><span class="line">    else</span><br><span class="line">printf "mongodb备份压缩完成    $(date  +%Y%m%d_%A_%Z%T)\n"</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo "剩余容量: `df -h |awk -F '[ ]+' 'NR==7&#123;print $4&#125;'`"</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/08/26/aSNUz9phrke3jc5.png" alt="3G一个.png"><br>压缩完的结果就是上图一样，只是个数较多。<br>接下来的问题是：现网网络带宽有限，如何把这些压缩包传回到本地。这里采用的 早上6点至晚上10点，进行限速传（限速500KB/s），晚上10点后至早上6点采取不限速。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"># SFTP传输脚本</span><br><span class="line"># IP地址</span><br><span class="line">IP=本地IP</span><br><span class="line"># PORT端口</span><br><span class="line">PORT=本地端口号</span><br><span class="line"># USER用户名</span><br><span class="line">USER=本地用户</span><br><span class="line"># PASSWD密码</span><br><span class="line">PASSWD=用户密码</span><br><span class="line">#压缩包所在目录</span><br><span class="line">CLIENTDIR=/data_master/backup/</span><br><span class="line">#SFTP服务器待下载目录</span><br><span class="line">SEVERDIR=/sftp/data_master/</span><br><span class="line"># 设置当前小时</span><br><span class="line"># xiaoshi=`date  +&quot;%Y-%m-%d %H:%M.%S&quot;|awk -F &quot;[ :]+&quot; &apos;&#123;print $2&#125;&apos;`</span><br><span class="line">#待下载文件名</span><br><span class="line"># FILE=</span><br><span class="line">while :</span><br><span class="line">do</span><br><span class="line">xiaoshi=`date  +&quot;%Y-%m-%d %H:%M.%S&quot;|awk -F &quot;[ :]+&quot; &apos;&#123;print $2&#125;&apos;`</span><br><span class="line">if [ $&#123;xiaoshi&#125; -ge 6 ] &amp;&amp; [ $&#123;xiaoshi&#125; -lt 22 ];</span><br><span class="line">    then</span><br><span class="line">        echo &quot;大于6时并小于22时，应该执行限速&quot;</span><br><span class="line">File=`head -1 /home/lsy/Sftp.txt`</span><br><span class="line"></span><br><span class="line">printf &quot;开始传输压缩备份    $(date  +%Y%m%d_%A_%Z%T)\n&quot; &gt;&gt;/home/lsy/sftp_file.log</span><br><span class="line">cd $&#123;CLIENTDIR&#125;</span><br><span class="line">lftp -u 用户,密码 sftp://本地IP地址:端口号 &lt;&lt; EOF</span><br><span class="line">cd $&#123;SEVERDIR&#125;</span><br><span class="line">lcd $&#123;CLIENTDIR&#125;</span><br><span class="line">set net:limit-rate 500000:500000</span><br><span class="line">reput $&#123;File&#125;</span><br><span class="line">by</span><br><span class="line">EOF</span><br><span class="line">if [ $? -eq 0 ]</span><br><span class="line">    then</span><br><span class="line">        echo &quot;传输成功。下面是文件名&quot; &gt;&gt;/home/lsy/sftp_file.log</span><br><span class="line">        echo $&#123;File&#125; &gt;&gt;/home/lsy/sftp_file.log</span><br><span class="line">        sleep 3</span><br><span class="line">    else</span><br><span class="line">        echo &quot;传输失败。&quot; &gt;&gt;/home/lsy/sftp_file.log</span><br><span class="line">        sleep 5</span><br><span class="line">        exit 2</span><br><span class="line">fi</span><br><span class="line">sed -i 1d /home/lsy/Sftp.txt</span><br><span class="line">printf &quot;传输完成    $(date  +%Y%m%d_%A_%Z%T)\n&quot; &gt;&gt;/home/lsy/sftp_file.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">    echo &quot;取消限速&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">File=`head -1 /home/lsy/Sftp.txt`</span><br><span class="line"></span><br><span class="line">printf &quot;开始传输压缩备份    $(date  +%Y%m%d_%A_%Z%T)\n&quot; &gt;&gt;/home/lsy/sftp_file.log</span><br><span class="line">cd $&#123;CLIENTDIR&#125;</span><br><span class="line">lftp -u 用户,密码 sftp://本地IP:端口 &lt;&lt; EOF</span><br><span class="line">cd $&#123;SEVERDIR&#125;</span><br><span class="line">lcd $&#123;CLIENTDIR&#125;</span><br><span class="line">reput $&#123;File&#125;</span><br><span class="line">by</span><br><span class="line">EOF</span><br><span class="line">if [ $? -eq 0 ]</span><br><span class="line">    then</span><br><span class="line">        echo &quot;传输成功。下面是文件名&quot; &gt;&gt;/home/lsy/sftp_file.log</span><br><span class="line">        echo $&#123;File&#125; &gt;&gt;/home/lsy/sftp_file.log</span><br><span class="line">        sleep 3</span><br><span class="line">    else</span><br><span class="line">        echo &quot;传输失败。&quot; &gt;&gt;/home/lsy/sftp_file.log</span><br><span class="line">        sleep 5</span><br><span class="line">        exit 2</span><br><span class="line">fi</span><br><span class="line">sed -i 1d /home/lsy/Sftp.txt</span><br><span class="line">printf &quot;传输完成    $(date  +%Y%m%d_%A_%Z%T)\n&quot; &gt;&gt;/home/lsy/sftp_file.log</span><br><span class="line">fi</span><br><span class="line">done </span><br><span class="line">curl -s &quot;钉钉机器人&quot; -H &quot;Content-Type: application/json&quot; -d &quot;&#123;&apos;msgtype&apos;: &apos;text&apos;, &apos;text&apos;: &#123;&apos;content&apos;: \&quot;$(date +%Y%m%d-%H%M%S)：$(cat /home/lsy/sftp_file.log)\&quot;&#125;, &apos;at&apos;: &#123;&apos;isAtAll&apos;: true&#125; &#125;&quot;</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/08/26/aGcRtfbJewkIu1j.png" alt="lftp.png"></p><p>在这里有一点非常需要注意：set net:limit-rate 500000:500000 这个参数就是lftp进行限速的命令。网上找了好多文章，他们在 set net:limit-rate 500000,500000用的是,号 经过我实测和man lftp查看参数，这里用的是：希望大家少采坑。</p>]]></content>
    
    <summary type="html">
    
      &lt;!--[TOC]--&gt;
&lt;h2 id=&quot;背景介绍&quot;&gt;&lt;a href=&quot;#背景介绍&quot; class=&quot;headerlink&quot; title=&quot;背景介绍&quot;&gt;&lt;/a&gt;背景介绍&lt;/h2&gt;&lt;p&gt;因为备份数据的不断扩大，需要把现网备份的数据（2T左右）传回到本地进行异地保存。但是2T太大了，需要进行压缩，这里采用了3G一个压缩包的方式。以下是压缩脚本&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;生活需要冲，更需要缓存。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Centos7_SystemOptimization</title>
    <link href="http://yoursite.com/2017/09/16/Centos7-SystemOptimization/"/>
    <id>http://yoursite.com/2017/09/16/Centos7-SystemOptimization/</id>
    <published>2017-09-16T07:11:53.000Z</published>
    <updated>2019-09-06T08:25:45.800Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Centos7系统优化"><a href="#Centos7系统优化" class="headerlink" title="Centos7系统优化"></a>Centos7系统优化</h1><p><strong>说明：此优化适合在Centos7上。</strong><br><a href="https://www.cnblogs.com/jokerbj/p/9133093.html" target="_blank" rel="noopener">摘录于Jokerbj博客</a></p><blockquote><p>人生在勤，不索何获。</p></blockquote><a id="more"></a><h3 id="优化条目"><a href="#优化条目" class="headerlink" title="优化条目"></a>优化条目</h3><ul><li><strong>修改IP地址、网关、主机名、DNS等</strong></li><li><strong>关闭selinux，清空iptables</strong></li><li><strong>添加普通用户并进行sudo授权管理</strong></li><li><strong>更新yum源及必要软件安装</strong></li><li><strong>定时自动更新服务器时间</strong></li><li><strong>精简开机自启动服务</strong></li><li><strong>定时自动清理/var/spool/clientmqueue/目录垃圾文件，放置inode节点被占满</strong></li><li><strong>变更默认的ssh服务端口，禁止root用户远程连接</strong></li><li><strong>锁定关键文件系统</strong></li><li><strong>调整文件描述符大小</strong></li><li><strong>调整字符集，使其支持中文</strong></li><li><strong>去除系统及内核版本登录前的屏幕显示</strong></li><li><strong>禁止ping</strong></li><li><strong>历史记录</strong></li><li><strong>内核参数优化</strong></li><li><strong>升级具有典型漏洞的软件版本</strong></li></ul><h3 id="1-修改ip地址、网关、主机名、DNS等"><a href="#1-修改ip地址、网关、主机名、DNS等" class="headerlink" title="1.修改ip地址、网关、主机名、DNS等"></a>1.修改ip地址、网关、主机名、DNS等</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vi /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">DEVICE=eth0         #网卡名字</span><br><span class="line">BOOTPROTO=static    #静态IP地址获取状态 如：DHCP表示自动获取IP地址</span><br><span class="line">IPADDR=192.168.1.113            #IP地址</span><br><span class="line">NETMASK=255.255.255.0           #子网掩码</span><br><span class="line">ONBOOT=yes#引导时是否激活</span><br><span class="line">GATEWAY=192.168.1.1</span><br><span class="line">[root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">DEVICE=eth0</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=192.168.1.113</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">ONBOOT=yes</span><br><span class="line">GATEWAY=192.168.1.1</span><br><span class="line">[root@localhost ~]# vi /etc/sysconfig/network</span><br><span class="line">HOSTNAME=c64     #修改主机名，重启生效</span><br><span class="line">GATEWAY=192.168.1.1    #修改默认网关,如果上面eth0里面不配置网关的话，默认就使用这里的网关了。</span><br><span class="line">[root@localhost ~]# cat /etc/sysconfig/network</span><br><span class="line">HOSTNAME=c64</span><br><span class="line">GATEWAY=192.168.1.1</span><br><span class="line">我们也可以用  hostnamec64  来临时修改主机名，重新登录生效</span><br><span class="line">修改DNS</span><br><span class="line">[root@localhost ~]# vi /etc/resolv.conf   #修改DNS信息</span><br><span class="line">nameserver 114.114.114.114</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">[root@localhost ~]# cat /etc/resolv.conf  #查看修改后的DNS信息</span><br><span class="line">nameserver 114.114.114.114</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">[root@localhost ~]# service network restart   #重启网卡，生效</span><br><span class="line">重启网卡，也可以用下面的命令</span><br><span class="line">[root@localhost ~]# /etc/init.d/network restart</span><br></pre></td></tr></table></figure><h3 id="2-关闭selinux，清空iptables"><a href="#2-关闭selinux，清空iptables" class="headerlink" title="2.关闭selinux，清空iptables"></a>2.关闭selinux，清空iptables</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">关闭selinux防火墙</span><br><span class="line">默认云服务器都是关着的</span><br><span class="line">cat /etc/selinux/config </span><br><span class="line">setenforce 0 设置不启动</span><br><span class="line">getenforce   查看</span><br></pre></td></tr></table></figure><p><strong>清空iptables</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># iptables –F     #清理防火墙规则</span><br><span class="line"># iptables –L     #查看防火墙规则</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination</span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination</span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination</span><br><span class="line">#/etc/init.d/iptables save   #保存防火墙配置信息</span><br></pre></td></tr></table></figure><p><strong>针对centos7防火墙配置</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">修改防火墙</span><br><span class="line">CentOS切换为iptables防火墙</span><br><span class="line">firewall-cmd --state 查看防火墙状态</span><br><span class="line"></span><br><span class="line">切换到iptables首先应该关掉默认的firewalld，然后安装iptables服务。</span><br><span class="line">1、关闭firewall：</span><br><span class="line">systemctl stop firewalld.service </span><br><span class="line">systemctl disable firewalld.service #禁止firewall开机启动</span><br><span class="line"></span><br><span class="line">2、安装iptables防火墙</span><br><span class="line">yum install iptables-services #安装</span><br><span class="line">service iptables save</span><br><span class="line"></span><br><span class="line">3、编辑iptables防火墙配置</span><br><span class="line">vi /etc/sysconfig/iptables #编辑防火墙配置文件</span><br><span class="line">下边是一个完整的配置文件：</span><br><span class="line">在你运行完save中间插入下面的规则</span><br><span class="line">-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line">-A INPUT -p icmp -j ACCEPT</span><br><span class="line">-A INPUT -i lo -j ACCEPT</span><br><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT</span><br><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT</span><br><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 3306 -j ACCEPT</span><br><span class="line">-A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class="line">-A FORWARD -j REJECT --reject-with icmp-host-prohibited</span><br><span class="line">:wq! #保存退出</span><br><span class="line">systemctl start iptables.service  #开启</span><br><span class="line">systemctl enable iptables.service #设置防火墙开机启动</span><br></pre></td></tr></table></figure><p>附赠防火墙脚本，前提你已经切换至iptables</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">IPT=`which iptables`</span><br><span class="line">$IPT -F</span><br><span class="line">$IPT -X</span><br><span class="line">$IPT -P INPUT DROP</span><br><span class="line">$IPT -P FORWARD ACCEPT </span><br><span class="line">$IPT -P OUTPUT ACCEPT</span><br><span class="line">$IPT -N syn-flood</span><br><span class="line">##本地回环 内网允许任何</span><br><span class="line">$IPT -A INPUT -i lo -j ACCEPT</span><br><span class="line">$IPT -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line">$IPT -A INPUT -m state --state NEW -s 10.0.0.0/8 -j ACCEPT</span><br><span class="line"># ssh 端口开放 任何IP</span><br><span class="line">$IPT -A INPUT -m state --state NEW -p tcp --dport 22 -j ACCEPT</span><br><span class="line"># 根据需求填写相应的端口</span><br><span class="line">$IPT -A INPUT -p tcp -m multiport --dports 80,8087,89 -j ACCEPT</span><br><span class="line"># zabbix监控地址</span><br><span class="line">$IPT -A INPUT -p tcp -s zabbix.ip -m state --state NEW -m tcp --dport 10050 -j ACCEPT</span><br><span class="line"># ICMP 规则控制</span><br><span class="line">$IPT -A INPUT -p icmp -m limit --limit 100/sec --limit-burst 100 -j ACCEPT</span><br><span class="line">$IPT -A INPUT -p icmp -m limit --limit 1/s --limit-burst 10 -j ACCEPT</span><br><span class="line"># DOS防护</span><br><span class="line">$IPT -A INPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j syn-flood</span><br><span class="line">$IPT -A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class="line">$IPT -A syn-flood -p tcp -m limit --limit 3/sec --limit-burst 6 -j RETURN</span><br><span class="line">$IPT -A syn-flood -j REJECT --reject-with icmp-port-unreachable</span><br><span class="line"></span><br><span class="line">fwiptables.sh</span><br></pre></td></tr></table></figure><h3 id="3-添加普通用户并运行sudo授权管理"><a href="#3-添加普通用户并运行sudo授权管理" class="headerlink" title="3.添加普通用户并运行sudo授权管理"></a>3.添加普通用户并运行sudo授权管理</h3><p>可以参考：<a href="https://www.cnblogs.com/jokerbj/p/9117384.html" target="_blank" rel="noopener">https://www.cnblogs.com/jokerbj/p/9117384.html</a></p><h3 id="4-更新yum源及必要软件安装"><a href="#4-更新yum源及必要软件安装" class="headerlink" title="4.更新yum源及必要软件安装"></a>4.更新yum源及必要软件安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yum源文件</span><br><span class="line">yum update   更新源文件</span><br><span class="line">yum clean all  清除缓存</span><br><span class="line">yum makecache  建立yum缓存</span><br><span class="line">CentOS-Base.repo 网络源文件</span><br><span class="line">推荐使用阿里云  </span><br><span class="line">如果发生问题很可能是域名解析问题</span><br><span class="line">vim /etc/resolv.conf</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">阿里</span><br><span class="line">nameserver 100.100.2.138</span><br><span class="line">nameserver 100.100.2.136</span><br><span class="line">options timeout:2 attempts:3 rotate single-request-reopen</span><br></pre></td></tr></table></figure><p>接下来就要安装几个必要的软件了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install lrzsz ntpdate sysstat net-tools -y</span><br><span class="line">lrzsz 是上传下载的软件</span><br><span class="line">sysstat 是用来检测系统性能及效率的工具</span><br><span class="line">net-tools 没有ifconfig命令时候需要安装工具</span><br></pre></td></tr></table></figure><h3 id="5-定时自动更新服务器时间"><a href="#5-定时自动更新服务器时间" class="headerlink" title="5.定时自动更新服务器时间"></a>5.定时自动更新服务器时间</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">默认云服务器有同步的时间服务器</span><br><span class="line">修改时间 date</span><br><span class="line">硬件时间 hwclock --show</span><br><span class="line">同步公有时间服务器，可搭配任务计划，阿里云的时间服务器ntp.aliyun.com</span><br><span class="line">yum -y install ntp</span><br><span class="line">ntpdate asia.pool.ntp.org</span><br><span class="line">time.nist.gov</span><br><span class="line">time.nuri.net</span><br><span class="line">ntpdate asia.pool.ntp.org 或者 ntp.aliyun.com</span><br><span class="line">注意；如果出现ntpdate[24325]: the NTP socket is in use, exiting，需要systemctl stop ntpd.service停止，然后同步，之后再启动，阿里云服务器默认同步阿里云时间服务器</span><br></pre></td></tr></table></figure><h3 id="6-精简开机自启动服务"><a href="#6-精简开机自启动服务" class="headerlink" title="6.精简开机自启动服务"></a>6.精简开机自启动服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">修改启动服务</span><br><span class="line">systemctl 是管制服务的主要工具,它整合了chkconfig 与 service功能于一体。</span><br><span class="line">systemctl is-enabled iptables.service   #查询防火墙是否开机启动</span><br><span class="line">systemctl restart sshd #有可能不需要加service</span><br><span class="line">systemctl is-enabled servicename.service #查询服务是否开机启动</span><br><span class="line">systemctl enable *.service #开机运行服务</span><br><span class="line">systemctl disable *.service #取消开机运行</span><br><span class="line">systemctl start *.service #启动服务</span><br><span class="line">systemctl stop *.service #停止服务</span><br><span class="line">systemctl restart *.service #重启服务</span><br><span class="line">systemctl reload *.service #重新加载服务配置文件</span><br><span class="line">systemctl status *.service #查询服务运行状态</span><br><span class="line">systemctl --failed #显示启动失败的服务</span><br></pre></td></tr></table></figure><h3 id="7-定时自动清理-cat-var-spool-postfix-maildrop-目录垃圾文件，放置inode节点被占满"><a href="#7-定时自动清理-cat-var-spool-postfix-maildrop-目录垃圾文件，放置inode节点被占满" class="headerlink" title="7.定时自动清理 cat /var/spool/postfix/maildrop/目录垃圾文件，放置inode节点被占满"></a>7.定时自动清理 cat /var/spool/postfix/maildrop/目录垃圾文件，放置inode节点被占满</h3><p> centos7默认安装了postfix邮件服务，因此邮件位置 /var/spool/postfix/maildrop/会存在垃圾文件，如果长时间不清理，会导致inode数量不够用，从而无法存放文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /server/scripts -p</span><br><span class="line">vi /server/scripts/spool_clean.sh</span><br><span class="line">#!/bin/sh</span><br><span class="line">find/var/spool/clientmqueue/-typef -mtime +30|xargs rm-f</span><br></pre></td></tr></table></figure><p>然后将其加入到crontab定时任务中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &apos;*/30 * * * * /bin/sh /server/scripts/spool_clean.sh &gt;/dev/null 2&gt;&amp;1&apos; &gt;&gt; /var/spool/cron/root</span><br></pre></td></tr></table></figure><h3 id="8-变更默认的ssh服务端口，禁止root用户远程连接"><a href="#8-变更默认的ssh服务端口，禁止root用户远程连接" class="headerlink" title="8.变更默认的ssh服务端口，禁止root用户远程连接"></a>8.变更默认的ssh服务端口，禁止root用户远程连接</h3><p>可参考<a href="https://www.cnblogs.com/jokerbj/p/9117384.html" target="_blank" rel="noopener">https://www.cnblogs.com/jokerbj/p/9117384.html</a><br>我们默认不会禁止root登录，端口酌情处理</p><h3 id="9-锁定关键文件系统"><a href="#9-锁定关键文件系统" class="headerlink" title="9.锁定关键文件系统"></a>9.锁定关键文件系统</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">加锁，不可修改加锁文件</span><br><span class="line">[root@jokerpro ~]# chattr +i /etc/passwd</span><br><span class="line">[root@jokerpro ~]# lsattr /etc/passwd</span><br><span class="line">----i--------e-- /etc/passwd</span><br><span class="line">去锁，可以修改文件</span><br><span class="line">[root@jokerpro ~]# chattr -i /etc/passwd </span><br><span class="line">[root@jokerpro ~]# lsattr /etc/passwd   </span><br><span class="line">-------------e-- /etc/passwd</span><br></pre></td></tr></table></figure><p>使用chattr命令后，为了安全我们需要将其改名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /usr/bin/chattr /usr/bin/任意名称</span><br></pre></td></tr></table></figure><h3 id="10-调整文件描述符大小"><a href="#10-调整文件描述符大小" class="headerlink" title="10.调整文件描述符大小"></a>10.调整文件描述符大小</h3><p>　　文件描述符是由无符号整数表示的句柄，进程使用它来标识打开的文件。文件描述符与包括相关信息（文件的打开模式，文件的位置类型，文件的出始类型等）的文件对象相关联，这些信息被称作文件的上下文。文件描述符的有效范围是0到OPEN_MAX。<br>　　对于内核而言，所有打开的文件都是通过文件描述符引用的，当打开一个现有文件或创建一个新文件时，内核向进程返回一个文件描述符。当读或写一个文件时，使用open或create返回的文件描述符标识该文件，并将其作为参数传递给read或write。<br>可通过ulimit -a查看当前设置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># ulimit -a</span><br><span class="line">core file size          (blocks, -c) 0</span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 3895</span><br><span class="line">max locked memory       (kbytes, -l) 64</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line">open files                      (-n) 65535     # 文件描述符</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 0</span><br><span class="line">stack size              (kbytes, -s) 8192       # 堆栈文件</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line">max user processes              (-u) 3895</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br></pre></td></tr></table></figure><p>文件描述符</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">查看linux服务器文件描述符设置的情况</span><br><span class="line">ulimit -n 1024 默认打开的文件描述符就是1024</span><br><span class="line">对于高并发业务来讲，默认值肯定不够</span><br><span class="line">cat /etc/security/limits.conf 65535是最大支持的文件描述符</span><br><span class="line">root soft nofile 65535</span><br><span class="line">root hard nofile 65535</span><br><span class="line">可以使用下面一行来替代上面</span><br><span class="line">* - nofile 65535</span><br><span class="line">重启即可</span><br></pre></td></tr></table></figure><p>配置完成后，重新登录即可查看。<br><strong>提示：也可以把ulimit -SHn 65535命令临时生效，或者加入到/etc/rc.local，然后每次重启生效</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># cat &gt;&gt;/etc/rc.local&lt;&lt;EOF</span><br><span class="line"># open files</span><br><span class="line">ulimit -HSn 65535</span><br><span class="line"># stack size</span><br><span class="line">ulimit -s 65535</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="11-调整字符集，使其支持中文"><a href="#11-调整字符集，使其支持中文" class="headerlink" title="11.调整字符集，使其支持中文"></a>11.调整字符集，使其支持中文</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">修改字符编码，默认是LANG=en_US.UTF-8</span><br><span class="line">修改该文件之前，可以先查看已经安装的语言包：</span><br><span class="line">locale -a  可通过grep过滤查看是否有中文语言包</span><br><span class="line">如果没有语言包</span><br><span class="line">yum install kde-l10n-Chinese  </span><br><span class="line">yum reinstall glibc-common  </span><br><span class="line">安装完成后通过vi命令编辑配置文件</span><br><span class="line">vim /etc/locale.conf</span><br><span class="line">LANG=&quot;zh_CN.UTF-8&quot;</span><br><span class="line">source /etc/locale.conf</span><br></pre></td></tr></table></figure><h3 id="12-去除系统及内核版本登录前的屏幕显示"><a href="#12-去除系统及内核版本登录前的屏幕显示" class="headerlink" title="12.去除系统及内核版本登录前的屏幕显示"></a>12.去除系统及内核版本登录前的屏幕显示</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># cat /etc/redhat-release </span><br><span class="line">CentOS Linux release 7.4.1708 (Core) </span><br><span class="line"># cat /etc/issue</span><br><span class="line">\S</span><br><span class="line">Kernel \r on an \m</span><br></pre></td></tr></table></figure><h3 id="13-禁止linux系统被ping"><a href="#13-禁止linux系统被ping" class="headerlink" title="13.禁止linux系统被ping"></a>13.禁止linux系统被ping</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 开启禁止ping</span><br><span class="line">echo &quot;net.ipv4.icmp_echo_ignore_all=1&quot;  1&gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br><span class="line"># 关闭禁止ping</span><br><span class="line">首先要删除 /etc/sysctl.conf 里面net.ipv4.icmp_echo_ignore_all = 1 </span><br><span class="line">之后执行如下命令</span><br><span class="line">echo 0 1&gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</span><br><span class="line"># 后续就可以通过更改 cat  /proc/sys/net/ipv4/icmp_echo_ignore_all文件</span><br><span class="line">0 关闭 1 开启</span><br></pre></td></tr></table></figure><h3 id="14-历史记录"><a href="#14-历史记录" class="headerlink" title="14.历史记录"></a>14.历史记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 以下都是临时生效，默认1000不需要更改</span><br><span class="line"># 设置的是闲置账号的超时时间</span><br><span class="line">export TMOUT=10 10秒后提示超时时间</span><br><span class="line"># 设置终端history显示条数</span><br><span class="line">export HISTSIZE=5 只显示最近5条信息</span><br><span class="line"># 上面的终端显示对应的是 cat ~/.bash_history </span><br><span class="line">export HISTFILESIZE=5 该文件只保存5条信息</span><br><span class="line"># 清空历史记录</span><br><span class="line">history -c</span><br><span class="line"># 指定条数删除</span><br><span class="line">history -d 历史记录条属</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Centos7系统优化&quot;&gt;&lt;a href=&quot;#Centos7系统优化&quot; class=&quot;headerlink&quot; title=&quot;Centos7系统优化&quot;&gt;&lt;/a&gt;Centos7系统优化&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;说明：此优化适合在Centos7上。&lt;/strong&gt;&lt;br&gt;&lt;a href=&quot;https://www.cnblogs.com/jokerbj/p/9133093.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;摘录于Jokerbj博客&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;人生在勤，不索何获。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Centos6_SystemOptimization</title>
    <link href="http://yoursite.com/2017/09/06/centos6-SystemOptimization/"/>
    <id>http://yoursite.com/2017/09/06/centos6-SystemOptimization/</id>
    <published>2017-09-06T05:52:27.000Z</published>
    <updated>2019-09-06T06:35:13.706Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Centos6系统优化"><a href="#Centos6系统优化" class="headerlink" title="Centos6系统优化"></a>Centos6系统优化</h1><p><strong>说明：此优化适合在Centos6上。</strong><br><a href="https://www.cnblogs.com/qianjingchen/p/9547344.html" target="_blank" rel="noopener">摘录于浅景尘博客</a></p><blockquote><p>将来的你一定会感谢现在努力拼命的你。</p></blockquote><a id="more"></a><h4 id="1-关闭防火墙"><a href="#1-关闭防火墙" class="headerlink" title="1.关闭防火墙"></a>1.关闭防火墙</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/iptables stop</span><br><span class="line">/etc/init.d/iptables stop</span><br><span class="line">chkconfig iptables off</span><br></pre></td></tr></table></figure><h4 id="2-关闭selinux"><a href="#2-关闭selinux" class="headerlink" title="2.关闭selinux"></a>2.关闭selinux</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -i &apos;s#SELINUX=.*#SELINUX=disabled#g&apos; /etc/selinux/config</span><br><span class="line">sed -i &apos;s/SELINUX=enforcing/SELINUX=disabled/&apos; /etc/selinux/config</span><br><span class="line">grep SELINUX=disabled /etc/selinux/config </span><br><span class="line">setenforce 0</span><br><span class="line">getenforce</span><br></pre></td></tr></table></figure><h4 id="3-更新yum源"><a href="#3-更新yum源" class="headerlink" title="3.更新yum源"></a>3.更新yum源</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum -y install wget #没有先安装</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo  #7为Centos-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-6.repo  #7为epel-7.repo</span><br><span class="line">cd /etc/yum.repos.d/ &amp;&amp; mv CentOS-Base.repo CentOS-Base.repobak</span><br><span class="line">mv CentOS-6.repo CentOS-Base.repo #7一样</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line">yum update</span><br></pre></td></tr></table></figure><h4 id="4-精简开机启动项"><a href="#4-精简开机启动项" class="headerlink" title="4.精简开机启动项"></a>4.精简开机启动项</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chkconfig|egrep -v &quot;crond|sshd|network|rsyslog|sysstat&quot;|awk &apos;&#123;print &quot;chkconfig&quot;,$1,&quot;off&quot;&#125;&apos;|bash</span><br><span class="line">export LANG=en</span><br><span class="line">chkconfig --list|grep 3:on</span><br></pre></td></tr></table></figure><h4 id="5-grep高亮显示"><a href="#5-grep高亮显示" class="headerlink" title="5.grep高亮显示"></a>5.grep高亮显示</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;alias grep=&apos;grep --color=auto&apos;\nalias egrep=&apos;egrep --color=auto&apos;&quot; &gt;&gt;/etc/profile</span><br><span class="line">#说明：定义grep命令查找的内容有颜色显示，便于查看</span><br><span class="line">echo &quot;alias ll=&apos;ls -l --color --time-style=long-iso&apos;&quot; &gt;&gt;/etc/profile #时间长格式显示</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><h4 id="6-命令行用户-amp-主机名颜色区分"><a href="#6-命令行用户-amp-主机名颜色区分" class="headerlink" title="6.命令行用户&amp;主机名颜色区分"></a>6.命令行用户&amp;主机名颜色区分</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &apos;PS1=&quot;\[\e[37;40m\][\[\e[32;40m\]\u\[\e[37;40m\]@\h \[\e[35;40m\]\W\[\e[0m\]]\\$ &quot;&apos;  &gt;&gt;/root/.bashrc</span><br><span class="line">source /root/.bashrc</span><br><span class="line">#或者定制个性化：echo &apos;PS1=&quot;\[\e[37;40m\][\[\e[32;40m\]\u\[\e[37;40m\]@\h \[\e[35;40m\]\W\[\e[0m\]]\\$ \[\e[33;40m\]&quot;&apos; &gt;&gt;/root/.bashrc</span><br><span class="line">#或者纯颜色区分：echo &quot;export PS1=&apos;\[\e[33;1m\][\u@\h \W]\$ \[\e[0m\]&apos;&quot; &gt;&gt;/etc/profile &amp;&amp; source /etc/profile</span><br><span class="line">#修改终端显示用户名、主机名和日期颜色区分：PS1=&quot;\[\e[37;40m\][\[\e[32;40m\]\u\[\e[37;40m\]@\h \e[36;40m\]\t \[\e[35;40m\]\W\[\e[0m\]]\\$ \[\e[33;40m\]&quot;</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2019/09/06/E67KtVaA9oLhdMO.png" alt="E67KtVaA9oLhdMO.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PS:默认的特殊符号所代表的意义：</span><br><span class="line">  \d ：代表日期，格式为weekday month date，例如：&quot;Mon Aug 1&quot;</span><br><span class="line">　\H ：完整的主机名称。例如：我的机器名称为：fc4.linux，则这个名称就是fc4.linux</span><br><span class="line">　　\h ：仅取主机的第一个名字，如上例，则为fc4，.linux则被省略</span><br><span class="line">　　\t ：显示时间为24小时格式，如：HH：MM：SS</span><br><span class="line">　　\T ：显示时间为12小时格式</span><br><span class="line">　　\A ：显示时间为24小时格式：HH：MM</span><br><span class="line">　　\u ：当前用户的账号名称</span><br><span class="line">　　\v ：BASH的版本信息</span><br><span class="line">　　\w ：完整的工作目录名称。家目录会以 ~代替</span><br><span class="line">　　\W ：利用basename取得工作目录名称，所以只会列出最后一个目录</span><br><span class="line">　　\# ：下达的第几个命令</span><br><span class="line">　　$ ：提示字符，如果是root时，提示符为：# ，普通用户则为：$</span><br></pre></td></tr></table></figure><h4 id="7-提权普通用户可以sudo"><a href="#7-提权普通用户可以sudo" class="headerlink" title="7.提权普通用户可以sudo"></a>7.提权普通用户可以sudo</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">useradd lsy</span><br><span class="line">echo 123456|passwd --stdin lsy</span><br><span class="line">\cp /etc/sudoers /etc/sudoers.ori</span><br><span class="line">echo &quot;lsy  ALL=(ALL) NOPASSWD: ALL &quot; &gt;&gt;/etc/sudoers</span><br><span class="line">tail -1 /etc/sudoers</span><br><span class="line">visudo -c</span><br></pre></td></tr></table></figure><h4 id="8-设置系统中文字符集"><a href="#8-设置系统中文字符集" class="headerlink" title="8.设置系统中文字符集"></a>8.设置系统中文字符集</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/sysconfig/i18n /etc/sysconfig/i18n.ori</span><br><span class="line">echo &apos;LANG=&quot;zh_CN.UTF-8&quot;&apos; &gt;/etc/sysconfig/i18n  #默认就是en_US.UTF-8</span><br><span class="line">source /etc/sysconfig/i18n </span><br><span class="line">echo $LANG</span><br></pre></td></tr></table></figure><h4 id="9-设置系统时间同步"><a href="#9-设置系统时间同步" class="headerlink" title="9.设置系统时间同步"></a>9.设置系统时间同步</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &apos;#crond-id-001:time sync by human&apos; &gt;&gt;/var/spool/cron/root</span><br><span class="line">echo &quot;*/5 * * * * /usr/sbin/ntpdate time.nist.gov &gt;/dev/null 2&gt;&amp;1&quot;&gt;&gt;/var/spool/cron/root</span><br><span class="line">crontab -l</span><br><span class="line">#（或者：ntpdate cn.pool.ntp.org）</span><br><span class="line">#没有ntpdate命令：yum -y install ntpdate</span><br></pre></td></tr></table></figure><h4 id="10-加大文件描述符"><a href="#10-加大文件描述符" class="headerlink" title="10.加大文件描述符"></a>10.加大文件描述符</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo &apos;*               -       nofile          65535 &apos; &gt;&gt;/etc/security/limits.conf </span><br><span class="line">tail -1 /etc/security/limits.conf</span><br><span class="line">ulimit -SHn   65535 </span><br><span class="line">ulimit -n</span><br></pre></td></tr></table></figure><h4 id="11-优化系统内核信息"><a href="#11-优化系统内核信息" class="headerlink" title="11.优化系统内核信息"></a>11.优化系统内核信息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt;/etc/sysctl.conf&lt;&lt;EOF</span><br><span class="line">net.ipv4.tcp_fin_timeout = 2</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.tcp_keepalive_time = 600</span><br><span class="line">net.ipv4.ip_local_port_range = 4000    65000</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 16384</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 36000</span><br><span class="line">net.ipv4.route.gc_timeout = 100</span><br><span class="line">net.ipv4.tcp_syn_retries = 1</span><br><span class="line">net.ipv4.tcp_synack_retries = 1</span><br><span class="line">net.core.somaxconn = 16384</span><br><span class="line">net.core.netdev_max_backlog = 16384</span><br><span class="line">net.ipv4.tcp_max_orphans = 16384</span><br><span class="line">#以下参数是对iptables防火墙的优化，防火墙不开会提示，可以忽略不理。</span><br><span class="line">net.nf_conntrack_max = 25000000</span><br><span class="line">net.netfilter.nf_conntrack_max = 25000000</span><br><span class="line">net.netfilter.nf_conntrack_tcp_timeout_established = 180</span><br><span class="line">net.netfilter.nf_conntrack_tcp_timeout_time_wait = 120</span><br><span class="line">net.netfilter.nf_conntrack_tcp_timeout_close_wait = 60</span><br><span class="line">net.netfilter.nf_conntrack_tcp_timeout_fin_wait = 120</span><br><span class="line">net.core.wmem_default = 8388608</span><br><span class="line">net.core.rmem_default = 8388608</span><br><span class="line">net.core.wmem_max = 16777216</span><br><span class="line">net.core.rmem_max = 16777216</span><br><span class="line">EOF</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><h4 id="12-安装系统常用小软件（大礼包）"><a href="#12-安装系统常用小软件（大礼包）" class="headerlink" title="12.安装系统常用小软件（大礼包）"></a>12.安装系统常用小软件（大礼包）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install vim lrzsz nmap tree dos2unix nc zip unzip pigz -y</span><br></pre></td></tr></table></figure><h4 id="13-ssh连接慢速度优化"><a href="#13-ssh连接慢速度优化" class="headerlink" title="13.ssh连接慢速度优化"></a>13.ssh连接慢速度优化</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i.bak &apos;s@#UseDNS yes@UseDNS no@g;s@^GSSAPIAuthentication yes@GSSAPIAuthentication no@g&apos; /etc/ssh/sshd_config</span><br><span class="line">/etc/init.d/sshd reload</span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/qianjingchen/p/8038821.html" target="_blank" rel="noopener">一键优化参考脚本</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Centos6系统优化&quot;&gt;&lt;a href=&quot;#Centos6系统优化&quot; class=&quot;headerlink&quot; title=&quot;Centos6系统优化&quot;&gt;&lt;/a&gt;Centos6系统优化&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;说明：此优化适合在Centos6上。&lt;/strong&gt;&lt;br&gt;&lt;a href=&quot;https://www.cnblogs.com/qianjingchen/p/9547344.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;摘录于浅景尘博客&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;将来的你一定会感谢现在努力拼命的你。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
  </entry>
  
</feed>
